{% extends "base.html" %}{% block content %}
<h2>Job #{{ object.id }}</h2>
<p>
  Program: <a href="{% url 'program_detail' object.program.pk %}">
    {{ object.program.part_no }} {{ object.program.revision }}</a><br>
  Machine: {{ object.machine.name }} • Material: {{ object.material.name }}<br>
  Qty: {{ object.qty }} • WCS: {{ object.wcs }} • Status: <strong>{{ object.get_status_display }}</strong>
</p>

{% if request.user.id == object.owner_id %}
<div style="display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0">
  <a class="btn" href="{% url 'job_edit' object.pk %}">Edit</a>
  <form method="post" action="{% url 'job_delete' object.pk %}" style="display:inline">{% csrf_token %}
    <button class="btn" style="background:#ef4444" onclick="return confirm('Delete this job?')">Delete</button>
  </form>
  {% if object.status == "draft" %}
    <a class="btn" href="{% url 'job_submit' object.pk %}">Submit</a>
  {% elif object.status == "submitted" %}
    <a class="btn" href="{% url 'job_approve' object.pk %}">Approve</a>
  {% endif %}
  <a class="btn" href="{% url 'job_packet' object.pk %}">View Packet</a>
</div>
{% endif %}

<h3>Run Log</h3>
{% if object.runlog_set.all %}
  <ul>
    {% for r in object.runlog_set.all|dictsortreversed:"created_at" %}
      <li>{{ r.created_at|date:"Y-m-d H:i" }} — {{ r.user.username }} — {{ r.action }} {% if r.notes %}— {{ r.notes }}{% endif %}</li>
    {% endfor %}
  </ul>
{% else %}<p>No activity yet.</p>{% endif %}
{% endblock %}